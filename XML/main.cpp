#include <stdio.h>
#include <string.h>
#include <assert.h>

#include "xml.h"

XmlParser parser, resultParser;
char basicInput[] = R"(
<?xml version="1.0" encoding="UTF-8"?>
<s:Envelope s:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Body><u:BrowseResponse xmlns:u="urn:schemas-upnp-org:service:ContentDirectory:1"><Result>&lt;DIDL-Lite xmlns="urn:schemas-upnp-org:metadata-1-0/DIDL-Lite/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:upnp="urn:schemas-upnp-org:metadata-1-0/upnp/" xmlns:dlna="urn:schemas-dlna-org:metadata-1-0/"&gt;&lt;container id="ab31bafbbb287b8e9bb9" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Nat King Cole - 20 Golden Greats (2004)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="284e3a7aa8db451975c6" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Lily Allen - Alright, Still... (2006)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="96066770052a2b195a5d" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - Anything Goes (1988)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="86a42efa2b1d22f16123" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;James Blunt - Back To Bedlam (2005)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="e13b7a9749b78dfe760d" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Amy Winehouse - Back to Black (2006)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="cf3b79c00b21393e1b20" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Malcolm Messiter, Guildhall String Ensemble - Baroque Oboe Concertos (1990)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="ec45280d1c461eb302cd" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - Best Of Bond... James Bond (2008)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="e3b256e24e621df0faf9" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - Best of British (2002)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="1f1124ec5c8dd405ac80" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;James - The Best of James (1998)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="0b1e23efb4254f51f3c0" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Motörhead - The best of Motörhead. Deaf forever (1998)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="0983ae030b9f6710f5fa" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Doors - The Best Of The Doors (1985)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="24b3ee13ea79168e8a9b" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;U2 - The Best of U2 (1998)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="c0489a5ec608cffd398f" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various - The Best Party In The World... Ever! (1997)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="3f0bc4f382b13d115d91" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - The Best Sixties Album in the World...Ever! (1995)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="67611578f2c77a248baf" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - The Best Sixties Summer Party... Ever! (2002)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="24ce2b93a1ec9ae2312f" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - The Best TV Ads ... Ever (2000)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="d53a752caddb8ce5aacd" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;M People - Bizarre Fruit (1994)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="4cef53f07817f0bc8e14" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Massive Attack - Blue Lines (2012)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="67e0de8d3c62312ceae9" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;The Brandenburg Consort, Roy Goodman - The Brandenburg Concertos (1996)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="96a15ac0853388054004" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Red Hot Chili Peppers - By the Way (2002)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="619445711b4c3214e176" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Dylan Thomas - The Caedmon Collection (2004)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="de12e1aded70f9a07278" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Fiona - Café on the moon&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="4d2b3fcda133cd139760" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Katie Melua - Call Off the Search (2003)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="089213470c2ee1663833" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Edita Gruberova, soprano; John Aler, tenor; Thomas Hampson, baritone; Shin-Yu Kai Choir; Knabenchor Des Staats- und Domchores B - Carmina Burana (2001)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="aee52b8260a3b284181f" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;The Casablanca Steps - The Casablanca Steps (2019)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="762976fa58390f33dab3" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Vladimir Ashkenazy - Chopin Favourites (1996)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="b05b83d0949e0deb1c3b" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Wiltshire Wailers - Christmas 2010&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="6593c82a0279ce38d10a" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - Classical 2008 (2007)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="63b5a90ce2f314e6a3e7" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - Classics for Children (1999)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="24f829f84456dcb66e11" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Dusty Springfield - The Collection (2000)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="8940a993bcc5ab39a22d" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Elaine Page - A Collection (2002)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="6552ed77d2ebbfd26d27" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Tom Jones - The Complete Tom Jones (1992)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="2f39643c6d67e52188fd" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Academy &amp;amp; Chorus of St. Martin‐in‐the‐Fields, Sir Neville Marriner - Coronation Anthems (1985)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="03c0ee86003654bad13f" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;The Casablanca Steps - Crazy words, crazy tunes&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="2a23f1d33a9eb640fd54" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Eric Clapton - The Cream of Clapton (1994)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="45216bb634416a297a76" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Pink Floyd - The Dark Side of the Moon (1994)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="a766933ffd5ea9138c59" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;The Killers - Day &amp;amp; Age (2008)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="0bc89da03a6f17f8489a" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Don Carlos - Day to Day Living (1982)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="87dc0f7adac08e4fd7e5" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Plan B - The Defamation of Strickland Banks (2010)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="a0369fd7595cac0af42d" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Simon &amp;amp; Garfunkel - The Definitive Simon and Garfunkel (1991)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="4fc1679efff86d73dab7" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Sade - Diamond Life (1984)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="e6ff1a0c23a03fd37598" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Tinie Tempah - Disc-Overy (2010)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="b29c37ffe516c8f2877c" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;The Cure - Disintegration (1989)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="dc9caf87f38550f9d06f" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - Disney Princess ultimate song collection (2004)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="a8ad4ce43b8c6179e713" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Nina Simone - Feeling Good The Very Best Of Nina Simone (1994)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="122b1c36ed00e57cbdad" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Kylie Minogue - Fever (2001)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="aa3d2534d320eb6bc6d8" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;The Sixteen - The Flower of all Virginity (2003)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="be9434fcc663160ead1e" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Amy Winehouse - Frank (2003)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="0e034521a26760addb83" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Frank Sinatra - Frank Sinatra sings The Select Cole Porter (1991)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="1e809fd7da66ac4a350c" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Frankie Goes to Hollywood - Frankie Said (2012)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="18a06a57efc7becaf0e4" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Will Young - Friday&amp;apos;s Child (2003)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="a8c2e21db42a0c7f0c5d" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - Gangsta Rap (1999)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="f9bfe3117313d7cc263a" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various - Geoff Car CD1&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="f2e5b89376114dc4bf58" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - Get Swinging (2002)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="48cb00fe6562dcf4226a" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Ella Fitzgerald - Gold (2003)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="4a1a9489072fcd3f192c" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;ABBA - Gold: Greatest Hits (2004)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="f3a6a468ac41710b9fc3" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;The Streets - A Grand Don’t Come for Free (2004)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="fb2c277ff87a645c8d72" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;William Byrd - The Great Service (1993)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="a119001a7a04bce0da63" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Odyssey - The Greatest Hits (2003)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="919c23aa35a489015704" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;The Cure - The Head on the Door (2006)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="73e22aec011344120787" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - High School Musical (2006)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="71ccc88c28eac8fcd5e8" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - High School Musical 2 (2007)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="bec03b50335e7d0b3cb6" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - High School Musical 3: Senior Year (2008)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="072502947439a1124423" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Gothic Voices - Hildegard Of Bingen : A Feather On The Breath Of God (1983)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="000cd49387066b9ca6a2" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Keane - Hopes and Fears (2004)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="5ade19253736c8437a69" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Susan Boyle - I Dreamed a Dream (2009)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="0913ffb56e46ac38c0e5" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Alex Parks - Introduction (2003)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="99cbe60e8b35696853b6" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Travis - The Invisible Band (2001)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="2f8ed3b9e28e776f0e9f" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Sleeper - The It Girl (1996)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="addd85c6a496ad457637" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Lily Allen - It’s Not Me, It’s You (2009)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="984b766a16c37019d5a5" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Russian State Symphony Orchestra - Jazz Suites Nos 1 &amp;amp; 2 (2001)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="37608eac3918c4dce023" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Taverner Consort &amp;amp; Choir - Josquin Missa &amp;quot;Ave maris stella&amp;quot; (2019)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="7d99035d7719f67baa44" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;London Chamber Orchestra - LCO3 (2019)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="3aef658d975222205fe8" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Bob Marley and The Wailers - Legend (2002)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="44e0b23cb3e1f5dd17e1" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Nintendo Orchestra - The Legend of Zelda: 25th Anniversary Special Orchestra CD (2011)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="b6684c147bf8b23188f9" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Blur - Leisure (1991)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="d0f9202ba4305278b93e" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Dido - Life For Rent (2003)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="e174cd4dfb5a9606affe" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Sash! - Life Goes On (1998)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="8e8f836fd3dbcc4f157b" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Mika - Life In Cartoon Motion (2007)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="801244884a1002199f21" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Robbie Williams - Life Thru a Lens (1997)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="d6c94637c85e66840b80" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Pound Sound &amp;amp; AK47s - Live at the Corsham Fringe&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="dd0a6bd470ad6cb3cc79" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;The Jam - Live Jam (1993)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="92c23a41321aa61d4e30" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Eagles - Long Road Out of Eden (2007)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="ba7e3afaf8faa3a4705a" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - Love Actually (2003)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="e57b06c6bb6ed71af439" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Taverner Consort and Players - Madrigals of War and Love (1992)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="28ea2af23a5c7a2add0e" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - The Magic Of The Musicals (2004)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="3655aca1113d22da7020" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Dire Straits - Making Movies (1996)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="35d89ab5320dbbbd3cce" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Mala Junta Trio - Mala Junta Trio (1995)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="c4fe8b578a4ba76d6ece" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Travis - The Man Who (1999)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="0076c2ba38b98ede90f3" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;The Smiths - Meat Is Murder (1985)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="1095d2390d0f5af035df" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Gothic Voices - The Medieval Romantics: French Songs &amp;amp; Motets 1340-1440 (1991)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="207fa7c053c28cf8d734" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;John Eliot Gardiner - Messiah (1983)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="61aacf505ccb7b220e2c" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - Ministry Of Sound - Electronic 80s (2010)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="46adaeb4a8bf242d80f7" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - A Minstrel&amp;apos;s Music&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="c375c0592ed936148c12" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;The Sixteen - Missa Papae Marcelli (1990)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="ea909665acb8a70930e6" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Various artists - MOBO&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="0eec318815533b95b37e" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Gothic Voices - Music for the Lion-Hearted King (1989)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="61f55193b3747ca6feda" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Frank Sinatra - My Way - The Best Of Frank Sinatra (1997)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="13af5b5f5b063b3075d5" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;David Gray - A New Day at Midnight (2002)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;container id="ad77bdfd5d20bf431df2" parentID="9b55ecd3e74c09febffe" restricted="1"&gt;&lt;dc:title&gt;Dido - No Angel (2001)&lt;/dc:title&gt;&lt;upnp:class&gt;object.container.album.musicAlbum&lt;/upnp:class&gt;&lt;/container&gt;&lt;/DIDL-Lite&gt;</Result><NumberReturned>100</NumberReturned><TotalMatches>175</TotalMatches><UpdateID>84304278</UpdateID></u:BrowseResponse></s:Body></s:Envelope>
)";
/*
<abc>def</abc>
<abc geoff='He\'s great' jeanette="She's lovely">
<sub1>
<sub11>def</sub11>
</sub1>
<sub2>ghi</sub2>
</abc>
<Envelope><Result>&lt;gdxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&gt;</Result></Envelope>
<&quot;&apos;&amp;ghi>jkl</ghi>
<top><middle>second<bottom>embedded</bottom></middle></top>
<ns:empty/>
*/

void charCallback(char *pname, char c, void *pdata) {
  static int cycle = 1;
  
  assert(!strcmp(pname, "Result"));
  switch (cycle) {
    case 1:
      assert(c == '<');
      cycle = 2;
      break;
    case 2:
      assert(c == 'g');
      cycle = 3;
      break;
    case 3:
      assert(c == 'd');
      cycle = 4;
      break;
    case 4:
      assert(c == '>');
      cycle = 5;
      break;
    case 5:
      assert(c == 0);
      parser.setCharCallback(0);
      cycle = 0;
      break;
    default:
      break;
  }
}

void basicCallback(char *pname, char *pvalue) {
  static int cycle = 1;
  
  switch (cycle) {
    case 0:
      throw "Extra callback received";
    case 1:
      assert(!strcmp(pname, "abc"));
      assert(pvalue == NULL);
      cycle = 2;
      break;
    case 2:
      assert(!strcmp(pname, "abc"));
      assert(!strcmp(pvalue, "def"));
      cycle = 0;
      break;
    case 3:
      assert(!strcmp(pname, "Result"));
      assert(pvalue == NULL);
      parser.setCharCallback(charCallback);
      cycle = 4;
      break;
    case 4:
      assert(!strcmp(pname, "\"'&ghi"));
      assert(pvalue == NULL);
      cycle = 5;
      break;
    case 5:
      assert(!strcmp(pname, "\"'&ghi"));
      assert(!strcmp(pvalue, "jkl"));
      cycle = 0;
      break;
    default:
      break;
  }
}

void resultCallback(char *pname, char *pvalue, void *pdata) {
  if (pvalue) {
    printf("%s = %s\n", pname, pvalue);
  //} else {
    //printf("Result, %s starting\n", pname);
  }
}

void testCharCallback(char *pname, char value, void *pdata) {
  resultParser.processChar(value);
}

void testCallback(char *pname, char *pvalue, void *pdata) {
  if (pvalue && *pvalue) {
    printf("%s = %s\n", pname, pvalue);
  //} else {
    //printf("%s starting\n", pname);
  }
  if (!strcmp(pname, "Result")) {
    if (!pvalue) {
      parser.setCharCallback(testCharCallback);
      resultParser.reset();
    } else {
      parser.setCharCallback(0);
    }
  }
}

int main() {
  parser.setXmlCallback(testCallback);
  resultParser.setXmlCallback(resultCallback);
  for (int n = 0; n < strlen(basicInput); n++) {
    parser.processChar(basicInput[n]);
  }
  
  printf("Success!\n");
  return 0;
}

